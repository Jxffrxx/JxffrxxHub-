-- Nihub-Style Advanced UI Library
-- Combined Part 1 + Part 2 in a single script
-- Author: Your Name/Handle
-- GitHub: https://github.com/yourname/yourrepo

--////////////////////////////////////////////////
-- PART 1: CORE MODULE, SERVICES, BASIC WINDOW SETUP
--////////////////////////////////////////////////

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")
local CoreGui = game:GetService("CoreGui")

local LocalPlayer = Players.LocalPlayer

-- Because some exploits / script executors have different ways to handle the GUI
-- hierarchy, we'll check for a couple popular ones:
local function SafeInstanceParent(guiObject)
    local CoreGui = game:GetService("CoreGui")
    guiObject.Parent = CoreGui
end


-- Main library table
local NihubLibrary = {}

-- Store configuration flags, references, etc.
NihubLibrary.Flags = {}

-- Themes
NihubLibrary.Themes = {
    DefaultDarkGreen = {
        MainBackground     = Color3.fromRGB(15, 17, 19),
        SidebarBackground  = Color3.fromRGB(20, 25, 20),
        TopbarBackground   = Color3.fromRGB(25, 33, 25),
        AccentGreen        = Color3.fromRGB(15, 255, 128),
        AccentRed          = Color3.fromRGB(220, 50, 50),
        AccentText         = Color3.fromRGB(235, 235, 235),

        ShadowColor        = Color3.fromRGB(0, 0, 0),
        ShadowTransparency = 0.4,

        ElementBackground  = Color3.fromRGB(35, 40, 35),
        ElementHover       = Color3.fromRGB(45, 50, 45),

        ToggleEnabled      = Color3.fromRGB(0, 200, 100),
        ToggleDisabled     = Color3.fromRGB(80, 80, 80),

        SliderBar          = Color3.fromRGB(43, 105, 70),
        SliderProgress     = Color3.fromRGB(20, 200, 120),

        StrokeColor        = Color3.fromRGB(60, 60, 60),

        Font               = Enum.Font.Gotham,
        TextColor          = Color3.fromRGB(230, 230, 230),
    }
}
-- Default to "DefaultDarkGreen"
NihubLibrary.CurrentTheme = NihubLibrary.Themes.DefaultDarkGreen

-- Basic references for minimization / hidden states:
local Minimised = false
local Hidden = false
local BusyTween = false

-- Reusable tween helper
local function TweenObject(object, properties, duration, easingStyle, easingDirection)
    local style = easingStyle or Enum.EasingStyle.Quint
    local direction = easingDirection or Enum.EasingDirection.Out
    local ti = TweenInfo.new(duration, style, direction)
    local tween = TweenService:Create(object, ti, properties)
    tween:Play()
    return tween
end

-- Create main ScreenGui
local function CreateScreenGui()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "NihubPrivateUI"
    SafeInstanceParent(screenGui)
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Global
    return screenGui
end

-- CreateWindow (Part 1)
local function baseCreateWindow(settings)
    local screenGui = CreateScreenGui()

    local Window = {}
    Window._screenGui = screenGui
    Window._tabs = {}

    Window.Title = settings.Title or "Nihub Private"
    Window.Subtitle = settings.Subtitle or ""
    Window.Theme = settings.Theme or "DefaultDarkGreen"

    if NihubLibrary.Themes[Window.Theme] then
        NihubLibrary.CurrentTheme = NihubLibrary.Themes[Window.Theme]
    end

    local theme = NihubLibrary.CurrentTheme

    -- Main frame
    local MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Parent = screenGui
    MainFrame.BackgroundColor3 = theme.MainBackground
    MainFrame.BorderSizePixel = 0
    MainFrame.Position = UDim2.new(0.25, 0, 0.2, 0)
    MainFrame.Size = UDim2.new(0, 700, 0, 500)

    local corner = Instance.new("UICorner", MainFrame)
    corner.CornerRadius = UDim.new(0, 6)

    local stroke = Instance.new("UIStroke", MainFrame)
    stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    stroke.Thickness = 1
    stroke.Color = theme.StrokeColor
    stroke.Transparency = 0.6

    -- Shadow
    local ShadowHolder = Instance.new("Frame")
    ShadowHolder.Name = "ShadowHolder"
    ShadowHolder.BackgroundTransparency = 1
    ShadowHolder.Size = UDim2.new(1, 20, 1, 20)
    ShadowHolder.Position = UDim2.new(0, -10, 0, -10)
    ShadowHolder.Parent = MainFrame

    local ShadowImage = Instance.new("ImageLabel", ShadowHolder)
    ShadowImage.AnchorPoint = Vector2.new(0.5, 0.5)
    ShadowImage.BackgroundTransparency = 1
    ShadowImage.Image = "rbxassetid://1316045217"
    ShadowImage.ImageColor3 = theme.ShadowColor
    ShadowImage.Size = UDim2.new(1, 47, 1, 47)
    ShadowImage.Position = UDim2.new(0.5, 0, 0.5, 0)
    ShadowImage.ImageTransparency = theme.ShadowTransparency

    -- TopBar
    local TopBar = Instance.new("Frame")
    TopBar.Name = "TopBar"
    TopBar.Parent = MainFrame
    TopBar.BackgroundColor3 = theme.TopbarBackground
    TopBar.BorderSizePixel = 0
    TopBar.Size = UDim2.new(1, 0, 0, 40)

    local topCorner = Instance.new("UICorner", TopBar)
    topCorner.CornerRadius = UDim.new(0, 6)

    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Name = "TitleLabel"
    TitleLabel.Parent = TopBar
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Size = UDim2.new(1, -100, 1, 0)
    TitleLabel.Position = UDim2.new(0, 10, 0, 0)
    TitleLabel.Font = theme.Font
    TitleLabel.Text = Window.Title
    TitleLabel.TextSize = 16
    TitleLabel.TextColor3 = theme.TextColor
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left

    local HideButton = Instance.new("TextButton")
    HideButton.Name = "HideButton"
    HideButton.Parent = TopBar
    HideButton.BackgroundColor3 = Color3.fromRGB(255,0,0)
    HideButton.BackgroundTransparency = 1
    HideButton.Size = UDim2.new(0, 50, 1, 0)
    HideButton.Position = UDim2.new(1, -50, 0, 0)
    HideButton.Font = theme.Font
    HideButton.Text = "_"
    HideButton.TextSize = 18
    HideButton.TextColor3 = theme.TextColor

    HideButton.MouseButton1Click:Connect(function()
        if BusyTween then return end
        if Hidden then
            Hidden = false
            BusyTween = true
            TweenObject(MainFrame, {Size = UDim2.new(0, 700, 0, 500)}, 0.5)
            wait(0.5)
            BusyTween = false
        else
            Hidden = true
            BusyTween = true
            TweenObject(MainFrame, {Size = UDim2.new(0, 700, 0, 40)}, 0.5)
            wait(0.5)
            BusyTween = false
        end
    end)

    -- Dragging
    local dragging = false
    local dragStart, startPos

    TopBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = MainFrame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    TopBar.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            MainFrame.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)

    -- Sidebar
    local Sidebar = Instance.new("Frame")
    Sidebar.Name = "Sidebar"
    Sidebar.Parent = MainFrame
    Sidebar.Size = UDim2.new(0, 150, 1, -40)
    Sidebar.Position = UDim2.new(0, 0, 0, 40)
    Sidebar.BackgroundColor3 = theme.SidebarBackground
    Sidebar.BorderSizePixel = 0

    local sideCorner = Instance.new("UICorner", Sidebar)
    sideCorner.CornerRadius = UDim.new(0, 0)

    local TabButtonsHolder = Instance.new("Frame")
    TabButtonsHolder.Name = "TabButtonsHolder"
    TabButtonsHolder.Parent = Sidebar
    TabButtonsHolder.BackgroundTransparency = 1
    TabButtonsHolder.Size = UDim2.new(1, 0, 1, 0)

    local TabListLayout = Instance.new("UIListLayout", TabButtonsHolder)
    TabListLayout.FillDirection = Enum.FillDirection.Vertical
    TabListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    TabListLayout.Padding = UDim.new(0, 5)

    -- ContentFrame
    local ContentFrame = Instance.new("Frame")
    ContentFrame.Name = "ContentFrame"
    ContentFrame.Parent = MainFrame
    ContentFrame.BackgroundColor3 = theme.MainBackground
    ContentFrame.BorderSizePixel = 0
    ContentFrame.Position = UDim2.new(0, 150, 0, 40)
    ContentFrame.Size = UDim2.new(1, -150, 1, -40)

    local contentCorner = Instance.new("UICorner", ContentFrame)
    contentCorner.CornerRadius = UDim.new(0, 6)

    local contentStroke = Instance.new("UIStroke", ContentFrame)
    contentStroke.Color = theme.StrokeColor
    contentStroke.Thickness = 1
    contentStroke.Transparency = 0.6

    local PagesFolder = Instance.new("Folder")
    PagesFolder.Name = "PagesFolder"
    PagesFolder.Parent = ContentFrame

    Window.MainFrame         = MainFrame
    Window.Sidebar           = Sidebar
    Window.ContentFrame      = ContentFrame
    Window.PagesFolder       = PagesFolder
    Window.TabButtonsHolder  = TabButtonsHolder

    return Window
end

-- We'll store the original CreateWindow in a local and override it below.
NihubLibrary._baseCreateWindow = baseCreateWindow


--////////////////////////////////////////////////
-- PART 2: TAB CREATION & NAVIGATION
--////////////////////////////////////////////////

-- Reusable tween helper (re-declare if needed)
local function TweenObject2(object, properties, duration, easingStyle, easingDirection)
    local style = easingStyle or Enum.EasingStyle.Quint
    local direction = easingDirection or Enum.EasingDirection.Out
    local ti = TweenInfo.new(duration, style, direction)
    local tween = TweenService:Create(object, ti, properties)
    tween:Play()
    return tween
end

function NihubLibrary:CreateTab(window, tabName, iconId)
    local theme = self.CurrentTheme
    local TabButtonHolder = window.TabButtonsHolder
    local PagesFolder = window.PagesFolder

    -- 1) Page frame
    local PageFrame = Instance.new("ScrollingFrame")
    PageFrame.Name = tabName .. "_Page"
    PageFrame.Parent = PagesFolder
    PageFrame.BackgroundColor3 = theme.MainBackground
    PageFrame.BorderSizePixel = 0
    PageFrame.Size = UDim2.new(1, 0, 1, 0)
    PageFrame.Visible = false
    PageFrame.ScrollBarThickness = 4
    PageFrame.ScrollBarImageColor3 = Color3.fromRGB(80, 80, 80) 
    PageFrame.ZIndex = 2

    local PageLayout = Instance.new("UIListLayout")
    PageLayout.Name = "PageLayout"
    PageLayout.FillDirection = Enum.FillDirection.Vertical
    PageLayout.SortOrder = Enum.SortOrder.LayoutOrder
    PageLayout.Padding = UDim.new(0, 8)
    PageLayout.Parent = PageFrame

    local PagePadding = Instance.new("UIPadding")
    PagePadding.Parent = PageFrame
    PagePadding.PaddingLeft = UDim.new(0, 10)
    PagePadding.PaddingTop  = UDim.new(0, 10)

    -- 2) Tab Button
    local ButtonFrame = Instance.new("Frame")
    ButtonFrame.Name = tabName .. "_Button"
    ButtonFrame.Parent = TabButtonHolder
    ButtonFrame.Size = UDim2.new(1, -10, 0, 40)
    ButtonFrame.BackgroundColor3 = Color3.fromRGB(20, 25, 20)
    ButtonFrame.BackgroundTransparency = 0.15
    ButtonFrame.BorderSizePixel = 0

    local corner = Instance.new("UICorner", ButtonFrame)
    corner.CornerRadius = UDim.new(0, 6)

    local stroke = Instance.new("UIStroke", ButtonFrame)
    stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    stroke.Thickness = 1
    stroke.Color = theme.StrokeColor
    stroke.Transparency = 0.7

    local LayoutButton = Instance.new("TextButton")
    LayoutButton.Name = "LayoutButton"
    LayoutButton.Parent = ButtonFrame
    LayoutButton.Size = UDim2.new(1, 0, 1, 0)
    LayoutButton.BackgroundTransparency = 1
    LayoutButton.Text = ""
    LayoutButton.ZIndex = 2

    local IconImage = Instance.new("ImageLabel")
    IconImage.Name = "IconImage"
    IconImage.Parent = ButtonFrame
    IconImage.Size = UDim2.new(0, 20, 0, 20)
    IconImage.Position = UDim2.new(0, 8, 0.5, -10)
    IconImage.BackgroundTransparency = 1
    IconImage.ImageColor3 = theme.TextColor
    if iconId then
        IconImage.Image = "rbxassetid://" .. tostring(iconId)
    else
        IconImage.Image = ""
    end

    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Name = "TitleLabel"
    TitleLabel.Parent = ButtonFrame
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Position = UDim2.new(0, iconId and 38 or 10, 0, 0)
    TitleLabel.Size = UDim2.new(1, -(iconId and 38 or 10), 1, 0)
    TitleLabel.Font = theme.Font
    TitleLabel.TextColor3 = theme.TextColor
    TitleLabel.TextSize = 15
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.Text = tabName

    -- Animate in
    ButtonFrame.BackgroundTransparency = 1
    stroke.Transparency = 1
    TitleLabel.TextTransparency = 1
    IconImage.ImageTransparency = 1

    TweenObject2(ButtonFrame, {BackgroundTransparency = 0.15}, 0.6)
    TweenObject2(stroke, {Transparency = 0.7}, 0.6)
    TweenObject2(TitleLabel, {TextTransparency = 0}, 0.6)
    TweenObject2(IconImage, {ImageTransparency = 0}, 0.6)

    -- 3) Behavior
    local function SwitchToThisTab()
        for _, child in ipairs(PagesFolder:GetChildren()) do
            if child:IsA("ScrollingFrame") then
                child.Visible = false
            end
        end
        PageFrame.Visible = true

        for _, b in ipairs(TabButtonHolder:GetChildren()) do
            if b:IsA("Frame") and b ~= ButtonFrame then
                TweenObject2(b, {BackgroundTransparency = 0.35}, 0.3)
                if b:FindFirstChild("TitleLabel") then
                    TweenObject2(b.TitleLabel, {TextTransparency = 0.2}, 0.3)
                end
            end
        end
        TweenObject2(ButtonFrame, {BackgroundTransparency = 0.05}, 0.3)
        TweenObject2(TitleLabel, {TextTransparency = 0}, 0.3)
    end

    LayoutButton.MouseButton1Click:Connect(function()
        SwitchToThisTab()
    end)

    local Tab = {}
    Tab.Name = tabName
    Tab.PageFrame = PageFrame
    Tab.ButtonFrame = ButtonFrame

    -- If no other pages are visible, make this tab visible
    local noPagesVisible = true
    for _, c in ipairs(PagesFolder:GetChildren()) do
        if c:IsA("ScrollingFrame") and c.Visible then
            noPagesVisible = false
            break
        end
    end
    if noPagesVisible then
        PageFrame.Visible = true
        TweenObject2(ButtonFrame, {BackgroundTransparency = 0.05}, 0.3)
        TweenObject2(TitleLabel, {TextTransparency = 0}, 0.3)
    end

    -- Example: Add CreateSection method
    function Tab:CreateSection(sectionName)
        local SectionFrame = Instance.new("Frame")
        SectionFrame.Name = (sectionName or "Section").."_Section"
        SectionFrame.Parent = PageFrame
        SectionFrame.BackgroundColor3 = theme.ElementBackground
        SectionFrame.BorderSizePixel = 0
        SectionFrame.Size = UDim2.new(1, -10, 0, 40)

        local scorner = Instance.new("UICorner", SectionFrame)
        scorner.CornerRadius = UDim.new(0, 4)

        local sstroke = Instance.new("UIStroke", SectionFrame)
        sstroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
        sstroke.Thickness = 1
        sstroke.Color = theme.StrokeColor
        sstroke.Transparency = 0.6

        local Title = Instance.new("TextLabel")
        Title.Name = "SectionTitle"
        Title.Parent = SectionFrame
        Title.BackgroundTransparency = 1
        Title.Position = UDim2.new(0, 10, 0, 0)
        Title.Size = UDim2.new(1, -20, 1, 0)
        Title.Font = theme.Font
        Title.TextColor3 = theme.TextColor
        Title.TextSize = 14
        Title.TextXAlignment = Enum.TextXAlignment.Left
        Title.Text = sectionName or "New Section"

        SectionFrame.BackgroundTransparency = 1
        sstroke.Transparency = 1
        Title.TextTransparency = 1

        TweenObject2(SectionFrame, {BackgroundTransparency = 0}, 0.4)
        TweenObject2(sstroke, {Transparency = 0.6}, 0.4)
        TweenObject2(Title, {TextTransparency = 0}, 0.4)

        return SectionFrame
    end

    return Tab
end

-- We want to attach CreateTab to Window objects
function NihubLibrary._createWindowMethods(window)
    function window:CreateTab(tabName, iconId)
        return NihubLibrary:CreateTab(self, tabName, iconId)
    end
end

-- Now we override the top-level CreateWindow to incorporate the window methods
function NihubLibrary:CreateWindow(settings)
    local newWindow = self._baseCreateWindow(settings)
    self._createWindowMethods(newWindow)
    return newWindow
end

-- Return the library
return NihubLibrary
